<!DOCTYPE HTML>
<html>
<head>
<title>Загрузить</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- bootstrap -->
<link href="css/bootstrap.min.css" rel='stylesheet' type='text/css' media="all" />
<!-- //bootstrap -->
<link href="css/dashboard.css" rel="stylesheet">
<!-- Custom Theme files -->
<link href="css/style.css" rel='stylesheet' type='text/css' media="all" />
<script src="js/jquery-1.11.1.min.js"></script>
<!--start-smoth-scrolling-->
<!-- fonts -->
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
<!-- //fonts -->
<link rel="shortcut icon" type="image/png" href="images/favicon_circle.png">
<title>Golos.js</title>
<script src="https://wzrd.in/standalone/buffer"></script>
<script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
crossorigin="anonymous"></script>

<script
src="https://code.jquery.com/jquery-3.3.1.min.js"
integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
crossorigin="anonymous"></script>


<script src="golos.min_test.js"></script>
<script src="cookies.js"></script>
  <script>
    golos.config.set('websocket', 'wss://ws.testnet3.golos.io');
    golos.config.set('chain_id', '5876894a41e6361bde2e73278f07340f2eb8b41c2facd29099de9deef6cdb679');
    function upload() {
      const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('54.213.135.66', 80) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)

          var login = getCookie("login");
          var password = getCookie("password");
          var post_password = getCookie("post_password");
          console.log(login, password, post_password);
          
          var auths = {
            posting: [[post_password]]

          };
          var verifyResult = golos.auth.verify(login, password, auths);
          console.log('verify', verifyResult);

          var wif = "5KbcarnoXZ46e7cmjxSGMhJe3BnMP7JJ5ShUFEGDgjHYxaDBHqy";
          var parentAuthor = '';
          var parentPermlink = 'videotest';
          var author = login;
          var permlink = result[0].hash.toLowerCase();
          var title = $("#video_name").val();
          var body = result[0].hash;
          var jsonMetadata = '{}';
  

          golos.broadcast.comment(wif, parentAuthor, parentPermlink, author, permlink, title, body, jsonMetadata, function(err, result) {
            if (!err) {
              window.location.replace("index.html");
            } else {
              console.log(err);
            }
          });
        }, false);
      }
      const photo = document.getElementById("video_file");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }

$(document).ready(function() {
  if (getCookie("login")) {
      $(".auth-link").text("Выход");
      $(".auth-link").attr('href', '#');
      $(".signin").click(function () {
        deleteCookie("login");
        deleteCookie("password");
        deleteCookie("post_password");
        location.reload();
      });
  } else {
    $(".auth-link").text("Вход");
  }
});


  </script>



</head>
  <body>

		  <nav class="navbar navbar-inverse navbar-fixed-top">
			  <div class="container-fluid">
				  <div class="navbar-header">
					  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						  <span class="sr-only">Toggle navigation</span>
						  <span class="icon-bar"></span>
						  <span class="icon-bar"></span>
						  <span class="icon-bar"></span>
					  </button>
					  <a class="navbar-brand" href="index.html"><h1><img src="images/logo.png" alt="" /></h1></a>
				  </div>
				  <div id="navbar" class="navbar-collapse collapse">
					  <div class="header-top-right">
						  <div class="file">
							  <a href="upload.html">Загрузить</a>
						  </div>
						  <div class="signin">
							  <a class="auth-link" href="auth.html">Войти</a>
						  </div>
						  <div class="clearfix"> </div>
					  </div>
				  </div>
				  <div class="clearfix"> </div>
			  </div>
		  </nav>
		<!-- upload -->
		<div class="upload">
			<!-- container -->
			<div class="container">
				<div class="upload-grids">
					<div class="upload-right">
						<div class="upload-file">
              <div class="upload-info">
                <h5>Заголовок видео:</h5></br>
                <input style = "font-size: 2em; width: 70%; margin-bottom: 2em" id="video_name" type="text">
                <h5>Тэги:</h5></br>
                <input style = "font-size: 2em; width: 70%; margin-bottom: 2em" id="video_tags" type="text">
                <h5>Файл для загрузки:</h5>
                <input id="video_file" type="file" value="Choose file.." style="display:block; position:relative; opacity:1; top:auto; left:40%; width:auto; font-size:1em; margin-top:1em">
              <button onclick=upload() style="background: #266fb7; color: #FFF; font-size: 14px; border-radius: 3px; font-family: 'Open Sans', sans-serif; margin-top: 2em"> Загрузить видео </button>
						</div>
					</div>
				</div>
			</div>
			<!-- //container -->
		</div>
		<!-- //upload -->
			<!-- footer -->
		  <div class="footer">
			  <div class="container">
				  <div class="footer-grids">
					  <div class="footer-top">
						  <div class="footer-top-nav">
							  <ul>
								  <li><a href="about.html">О нас</a></li>
								  <li><a href="creators.html">Пользователям</a></li>
								  <li><a href="https://developers.golos.io/">Разработчикам</a></li>
							  </ul>
						  </div>
					  </div>
				  </div>
			  </div>
		  </div>
			<!-- //footer -->
		<div class="clearfix"> </div>
	<div class="drop-menu">
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu4">
		  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Regular link</a></li>
		  <li role="presentation" class="disabled"><a role="menuitem" tabindex="-1" href="#">Disabled link</a></li>
		  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Another link</a></li>
		</ul>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  </body>
</html>
